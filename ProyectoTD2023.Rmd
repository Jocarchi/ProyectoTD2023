---
title: "PreyectoTD2023"
autor: "Andres Chicaiza, Maria Castellanos, Hugo Lucas, Adrian Blat, Yuliana Villada"
output: html_document
date: "2023-04-18"
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r}
library(ggplot2)
library(dplyr)

#Cabecera digital

cab_dig1 <- "../data/data/1059xlxveei79_ECGf2/27_09_2022/14.42.29_III_ECGyEXTyRESTO/cabecera_FicheroDigital.dat"

cab_info_dig <- file.info("../data/data/1059xlxveei79_ECGf2/27_09_2022/14.42.29_III_ECGyEXTyRESTO/cabecera_FicheroDigital.dat")

max_cabdig1 <- cab_info_dig$size

cabecera_dig1 <- readBin(cab_dig1,integer(),n = max_cabdig1,size = 1, signed = F)


#Fichero digital

fich_dig1 <- "../data/data/1059xlxveei79_ECGf2/27_09_2022/14.42.29_III_ECGyEXTyRESTO/ficheroDigital.dat"

fich_info <- file.info("../data/data/1059xlxveei79_ECGf2/27_09_2022/14.42.29_III_ECGyEXTyRESTO/ficheroDigital.dat")

max_fichdig1 <- fich_info$size

fichero_dig1 <- readBin(fich_dig1,integer(),n = max_fichdig1,size = 1, signed = F)

HR1 <- fichero_dig1[seq(from=1, to = length(fichero_dig1), by = 9)]
HR2 <- fichero_dig1[seq(from=2, to = length(fichero_dig1), by = 9)]
MHR <- fichero_dig1[seq(from=3, to = length(fichero_dig1), by = 9)]
TOCO <- fichero_dig1[seq(from=4, to = length(fichero_dig1), by = 9)]
MSpO2 <- fichero_dig1[seq(from=5, to = length(fichero_dig1), by = 9)]
VCP <- fichero_dig1[seq(from=6, to = length(fichero_dig1), by = 9)]
Psistolica <- fichero_dig1[seq(from=7, to = length(fichero_dig1), by = 9)]
Pdiastolica <- fichero_dig1[seq(from=8, to = length(fichero_dig1), by = 9)]
Pmedia <- fichero_dig1[seq(from=9, to = length(fichero_dig1), by = 9)]

mediaVCP <- mean(VCP)

lista <- list(HR1, HR2, MHR, TOCO, MSpO2, VCP, Psistolica, Pdiastolica, Pmedia)

nombres <- c("HR1", "HR2", "MHR", "TOCO", "MSpO2", "VCP", "Psistolica", "Pdiastolica", "Pmedia")

dato_dig1 <- as.data.frame(lista)

colnames(dato_dig1) <- nombres

tiempo <- seq(0, length.out = nrow(dato_dig1), by = 0.25)
tiempo <- head(tiempo, 2604)


dato_dig1 <- dato_dig1 %>%
    mutate(tiempo = tiempo)

hora <- ((((length(dato_dig1) / 9) / 4) / 60) / 60)
min <- ((hora - floor(hora)) * 60)
seg <- ((min - floor(min))) * 60
  
tiempo_digital <- cbind(hora, min, seg)

dato_dig1
```

```{r}
ggplot(dato_dig1, aes(tiempo,HR1)) + geom_line(size=0.2)
ggplot(dato_dig1, aes(tiempo,HR2)) + geom_line(size=0.2)
ggplot(dato_dig1, aes(tiempo,MHR)) + geom_line(size=0.2)
ggplot(dato_dig1, aes(tiempo,TOCO)) + geom_line(size=0.2)
ggplot(dato_dig1, aes(tiempo,MSpO2)) + geom_line(size=0.2)
ggplot(dato_dig1, aes(tiempo,VCP)) + geom_line(size=0.2)
ggplot(dato_dig1, aes(tiempo,Psistolica)) + geom_line(size=0.2)
ggplot(dato_dig1, aes(tiempo,Pdiastolica)) + geom_line(size=0.2)
ggplot(dato_dig1, aes(tiempo,Pmedia)) + geom_line(size=0.2)
```

```{r}
#Cabecera Analogica

cab_ana1 <- "../data/data/1059xlxveei79_ECGf2/27_09_2022/14.42.29_III_ECGyEXTyRESTO/cabecera_FicheroAnalogico.dat"

cab_info_ana <- file.info("../data/data/1059xlxveei79_ECGf2/27_09_2022/14.42.29_III_ECGyEXTyRESTO/cabecera_FicheroAnalogico.dat")

max_cabana1 <- cab_info_ana$size

cabecera_ana1.1 <- readBin(cab_dig1,integer(),n = max_cabana1,size = 1, signed = F)
cabecera_ana1.2 <- readBin(cab_dig1,integer(),n = max_cabana1,size = 2, signed = T)

# Fichero Analogico

fich_ana1 <- "../data/data/1059xlxveei79_ECGf2/27_09_2022/14.42.29_III_ECGyEXTyRESTO/ficheroAnalogico.dat"
fich_info_ana <- file.info("../data/data/1059xlxveei79_ECGf2/27_09_2022/14.42.29_III_ECGyEXTyRESTO/ficheroAnalogico.dat")
max_fichanal <- fich_info_ana$size

fichero_ana1 <- readBin(fich_ana1, integer(), n = max_fichanal, size = 2, signed = T)

Frec <- 1000

tiempo_ana1 <- seq(from = 0, to = (length(fichero_ana1)-1)/Frec, by = 1/Frec)

dato_ana1 <- data.frame(tiempo_ana1, fichero_ana1)

h <- ((length(dato_ana1)/Frec)/60)/60
min <- ((h - floor(h)) * 60)
seg <- ((min - floor(min)) * 60)

time_ana1 <- cbind(h,min,seg)



```

```{r}
ggplot(dato_ana1, aes(tiempo_ana1,fichero_ana1)) + geom_line(size = 1) + lims(x = c(692,700.03), y = c(-198,957))
```


